<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚ãã‚ã ã‹ã‚‹ãŸ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700&display=swap');

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            touch-action: none;
            background-color: #fff7ed;
            user-select: none;
            height: 100vh; /* ç”»é¢ã®é«˜ã•ãƒ”ãƒƒã‚¿ãƒªã«ã™ã‚‹ */
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ */
        }

        /* Start Screen */
        #startScreen {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.98);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        /* Header / Controls */
        .header-area {
            width: 100%;
            padding: 5px 15px; /* å°‘ã—é«˜ã•ã‚’è©°ã‚ã‚‹ */
            background: #ffedd5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #fb923c;
            height: 45px; /* å›ºå®šé«˜ã•ã‚’å°‘ã—ä½ã */
            flex-shrink: 0; /* ç¸®ã¾ãªã„ã‚ˆã†ã«ã™ã‚‹ */
        }
        .reset-btn {
            background: #cbd5e1;
            width: 32px; /* å°‘ã—å°ã•ã */
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            cursor: pointer;
            border: 2px solid #94a3b8;
        }

        /* Reader Area */
        .reader-area {
            width: 100%;
            padding: 8px; /* ä½™ç™½ã‚’å°‘ã—è©°ã‚ã‚‹ */
            background: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 85px; /* å°‘ã—é«˜ã•ã‚’è©°ã‚ã‚‹ */
            border-bottom: 4px solid #fb923c;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            z-index: 20;
            flex-shrink: 0; /* ç¸®ã¾ãªã„ã‚ˆã†ã«ã™ã‚‹ */
        }
        .reader-text {
            font-size: 1.4rem; /* å°‘ã—å°ã•ã */
            color: #ea580c;
            margin-bottom: 6px;
            font-weight: bold;
            white-space: nowrap;
        }
        .replay-btn {
            background: #fbbf24;
            color: #78350f;
            padding: 5px 20px; /* å°‘ã—å°ã•ã */
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 3px 0 #d97706;
            font-weight: bold;
        }
        .replay-btn:active { transform: translateY(3px); box-shadow: none; }

        /* Grid (ã“ã“ã‚’èª¿æ•´ï¼) */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3åˆ—ç¶­æŒ */
            gap: 6px; /* ã‚«ãƒ¼ãƒ‰é–“ã®éš™é–“ã‚’å°‘ã—ç‹­ã */
            width: 100%;
            max-width: 500px; /* å…¨ä½“ã®å¹…ã‚’å°‘ã—ç‹­ã‚ã¦ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
            padding: 10px;
            flex-grow: 1; /* æ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã„ã£ã±ã„ã«åºƒãŒã‚‹ */
            overflow-y: auto; /* å¿µã®ãŸã‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨±å¯ */
            align-content: center; /* ç¸¦æ–¹å‘ã‚‚ä¸­å¤®å¯„ã› */
        }

        /* Card (ã“ã“ã‚’èª¿æ•´ï¼) */
        .card {
            background: white;
            border-radius: 10px; /* è§’ä¸¸ã‚’å°‘ã—å°ã•ã */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 2px solid #fed7aa; /* æ ç·šã‚’å°‘ã—ç´°ã */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            aspect-ratio: 3/4; /* ç¸¦æ¨ªæ¯”ã¯ç¶­æŒ */
        }
        .card:active { background: #ffedd5; transform: scale(0.95); }
        .card.correct { border-color: #22c55e; background: #dcfce7; transform: scale(1.05); z-index: 10; }
        .card.taken { opacity: 0; pointer-events: none; }
        
        /* ã‚«ãƒ¼ãƒ‰ã®ä¸­èº«ã‚’å°‘ã—å°ã•ã */
        .card-char { font-size: 1.3rem; color: #ea580c; position: absolute; top: 2px; right: 4px; font-weight: bold; }
        .card-img { font-size: 2.6rem; }
        .card-word { font-size: 0.65rem; color: #9ca3af; margin-top: 1px; }

        /* Next Button Overlay */
        #nextOverlay {
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.9);
            z-index: 40;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .next-btn {
            background: #22c55e;
            color: white;
            font-size: 2.2rem;
            padding: 20px 80px;
            border-radius: 999px;
            box-shadow: 0 8px 0 #15803d;
            font-weight: bold;
            animation: bounce 1s infinite;
        }
        .next-btn:active { transform: translateY(4px); box-shadow: none; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        /* Status Line */
        #statusLine {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #333;
            color: #4ade80;
            font-size: 10px;
            padding: 2px;
            text-align: center;
            z-index: 100;
        }
    </style>
</head>
<body>

    <a href="index.html" style="position:fixed; top:5px; left:5px; z-index:100; background:white; width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; text-decoration:none; border:2px solid #fb923c; font-size:1.2rem; box-shadow:0 2px 5px rgba(0,0,0,0.2);">ğŸ </a>

    <div id="startScreen">
        <div class="text-7xl mb-6">ğŸš“ğŸ¶ğŸš…</div>
        <h1 class="text-4xl text-orange-600 font-bold mb-4">ã‚ãã‚ã ã‹ã‚‹ãŸ</h1>
        <p class="text-gray-500 mb-8 text-sm leading-relaxed">
            ã©ã†ã¶ã¤ ã‚„ ã®ã‚Šã‚‚ã® ãŒ<br>
            ãƒ©ãƒ³ãƒ€ãƒ ã§ ã§ã¦ãã‚‹ã‚ˆï¼
        </p>
        <button id="startBtn" class="bg-orange-500 text-white text-3xl font-bold py-5 px-16 rounded-full shadow-[0_6px_0_#c2410c] active:translate-y-1 transition-all">
            ã¯ã˜ã‚ã‚‹ï¼
        </button>
    </div>

    <div class="header-area">
        <div style="width: 36px;"></div> <div class="font-bold text-orange-800">ã‹ã‚‹ãŸ</div>
        <button onclick="resetSpeech()" class="reset-btn" title="éŸ³å£°ã‚’ãªãŠã™">ğŸ”„</button>
    </div>

    <div class="reader-area">
        <div id="displayText" class="reader-text">...</div>
        <button onclick="speakCurrent()" class="replay-btn">ğŸ”Š ã‚‚ã†ã„ã£ã‹ã„</button>
    </div>

    <div id="cardGrid" class="card-grid"></div>

    <div id="nextOverlay">
        <div class="text-5xl mb-6 text-green-500 font-bold">ã›ã„ã‹ã„ï¼â­•</div>
        <button id="nextBtn" class="next-btn">ã¤ãã¸ â–¶</button>
    </div>

    <div id="statusLine">æº–å‚™å®Œäº†</div>

    <script>
        // --- Master Data (Pool) ---
        const masterData = [
            // --- ã©ã†ã¶ã¤ ---
            { char: 'ã„', word: 'ã„ã¬', emoji: 'ğŸ¶', text: 'ã„ã¬ãŒ ã‚ã‚“ã‚ã‚“', speak: 'ã„ã¬ãŒã€ã‚ã‚“ã‚ã‚“' },
            { char: 'ã­', word: 'ã­ã“', emoji: 'ğŸ±', text: 'ã­ã“ãŒ ã«ã‚ƒãƒ¼ã«ã‚ƒãƒ¼', speak: 'ã­ã“ãŒã€ã«ã‚ƒãƒ¼ã«ã‚ƒãƒ¼' },
            { char: 'ã†', word: 'ã†ã•ã', emoji: 'ğŸ°', text: 'ã†ã•ããŒ ã´ã‚‡ã‚“ã´ã‚‡ã‚“', speak: 'ã†ã•ããŒã€ã´ã‚‡ã‚“ã´ã‚‡ã‚“' },
            { char: 'ã±', word: 'ã±ã‚“ã ', emoji: 'ğŸ¼', text: 'ã±ã‚“ã ãŒ ã‚‚ãã‚‚ã', speak: 'ã±ã‚“ã ãŒã€ã‚‚ãã‚‚ã' },
            { char: 'ã‚‰', word: 'ã‚‰ã„ãŠã‚“', emoji: 'ğŸ¦', text: 'ã‚‰ã„ãŠã‚“ ãŒãŠãƒ¼', speak: 'ã‚‰ã„ãŠã‚“ã€ãŒãŠãƒ¼' },
            { char: 'ã', word: 'ãã†', emoji: 'ğŸ˜', text: 'ãã†ã•ã‚“ ã±ãŠãƒ¼ã‚“', speak: 'ãã†ã•ã‚“ã€ã±ãŠãƒ¼ã‚“' },
            { char: 'ã•', word: 'ã•ã‚‹', emoji: 'ğŸµ', text: 'ã•ã‚‹ãŒ ã†ãã', speak: 'ã•ã‚‹ãŒã€ã†ãã' },
            { char: 'ã', word: 'ãã¾', emoji: 'ğŸ»', text: 'ãã¾ã•ã‚“ ã®ã£ã—ã®ã£ã—', speak: 'ãã¾ã•ã‚“ã€ã®ã£ã—ã®ã£ã—' },
            { char: 'ã', word: 'ãã‚Šã‚“', emoji: 'ğŸ¦’', text: 'ãã‚Šã‚“ã•ã‚“ é¦–ãªãŒã„', speak: 'ãã‚Šã‚“ã•ã‚“ã€ãã³ãªãŒã„' },
            { char: 'ãº', word: 'ãºã‚“ãã‚“', emoji: 'ğŸ§', text: 'ãºã‚“ãã‚“ ã‚ˆã¡ã‚ˆã¡', speak: 'ãºã‚“ãã‚“ã€ã‚ˆã¡ã‚ˆã¡' },
            { char: 'ã‹', word: 'ã‹ãˆã‚‹', emoji: 'ğŸ¸', text: 'ã‹ãˆã‚‹ãŒ ã‘ã‚ã‘ã‚', speak: 'ã‹ãˆã‚‹ãŒã€ã‘ã‚ã‘ã‚' },
            { char: 'ã“', word: 'ã“ã‚ã‚‰', emoji: 'ğŸ¨', text: 'ã“ã‚ã‚‰ãŒ ã™ã‚„ã™ã‚„', speak: 'ã“ã‚ã‚‰ãŒã€ã™ã‚„ã™ã‚„' },
            { char: 'ã¨', word: 'ã¨ã‚‰', emoji: 'ğŸ¯', text: 'ã¨ã‚‰ã•ã‚“ ã¤ã‚ˆã„ã', speak: 'ã¨ã‚‰ã•ã‚“ã€ã¤ã‚ˆã„ã' },
            { char: 'ã†', word: 'ã†ã¾', emoji: 'ğŸ´', text: 'ã†ã¾ãŒ ã²ã²ãƒ¼ã‚“', speak: 'ã†ã¾ãŒã€ã²ã²ãƒ¼ã‚“' },
            { char: 'ã†', word: 'ã†ã—', emoji: 'ğŸ®', text: 'ã†ã—ã•ã‚“ ã‚‚ãƒ¼ã‚‚ãƒ¼', speak: 'ã†ã—ã•ã‚“ã€ã‚‚ãƒ¼ã‚‚ãƒ¼' },
            { char: 'ã«', word: 'ã«ã‚ã¨ã‚Š', emoji: 'ğŸ”', text: 'ã«ã‚ã¨ã‚Š ã‚³ã‚±ã‚³ãƒƒã‚³ãƒ¼', speak: 'ã«ã‚ã¨ã‚Šã€ã“ã‘ã“ã£ã“ãƒ¼' },
            
            // --- ã®ã‚Šã‚‚ã® ---
            { char: 'ã±', word: 'ã±ã¨ã‹ãƒ¼', emoji: 'ğŸš“', text: 'ã±ã¨ã‹ãƒ¼ ã´ãƒ¼ã½ãƒ¼', speak: 'ã±ã¨ã‹ãƒ¼ã€ã´ãƒ¼ã½ãƒ¼' },
            { char: 'ã', word: 'ãã‚…ã†ãã‚…ã†ã—ã‚ƒ', emoji: 'ğŸš‘', text: 'ãã‚…ã†ãã‚…ã†ã—ã‚ƒ ãƒ”ãƒ¼ãƒãƒ¼', speak: 'ãã‚…ã†ãã‚…ã†ã—ã‚ƒã€ã´ãƒ¼ã½ãƒ¼' },
            { char: 'ã—', word: 'ã—ã‚‡ã†ã¼ã†ã—ã‚ƒ', emoji: 'ğŸš’', text: 'ã—ã‚‡ã†ã¼ã†ã—ã‚ƒ ã‚¦ãƒ¼ã‚«ãƒ³ã‚«ãƒ³', speak: 'ã—ã‚‡ã†ã¼ã†ã—ã‚ƒã€ã†ãƒ¼ã‹ã‚“ã‹ã‚“' },
            { char: 'ã§', word: 'ã§ã‚“ã—ã‚ƒ', emoji: 'ğŸšƒ', text: 'ã§ã‚“ã—ã‚ƒ ã‚¬ã‚¿ãƒ³ã‚´ãƒˆãƒ³', speak: 'ã§ã‚“ã—ã‚ƒã€ãŒãŸã‚“ã”ã¨ã‚“' },
            { char: 'ã—', word: 'ã—ã‚“ã‹ã‚“ã›ã‚“', emoji: 'ğŸš…', text: 'ã—ã‚“ã‹ã‚“ã›ã‚“ ãƒ“ãƒ¥ãƒ¼ãƒ³', speak: 'ã—ã‚“ã‹ã‚“ã›ã‚“ã€ã³ã‚…ãƒ¼ã‚“' },
            { char: 'ã°', word: 'ã°ã™', emoji: 'ğŸšŒ', text: 'ã°ã™ ãƒ—ãƒƒãƒ—ãƒ¼', speak: 'ã°ã™ã€ã·ã£ã·ãƒ¼' },
            { char: 'ãŸ', word: 'ãŸãã—ãƒ¼', emoji: 'ğŸš•', text: 'ãŸãã—ãƒ¼ ãŠãã‚ƒãã•ã‚“', speak: 'ãŸãã—ãƒ¼ã€ãŠãã‚ƒãã•ã‚“' },
            { char: 'ã¨', word: 'ã¨ã‚‰ã£ã', emoji: 'ğŸšš', text: 'ã¨ã‚‰ã£ã ãƒ–ãƒ¼ãƒ³', speak: 'ã¨ã‚‰ã£ãã€ã¶ãƒ¼ã‚“' },
            { char: 'ã²', word: 'ã²ã“ã†ã', emoji: 'âœˆï¸', text: 'ã²ã“ã†ã ã‚­ãƒ¼ãƒ³', speak: 'ã²ã“ã†ãã€ããƒ¼ã‚“' },
            { char: 'ãµ', word: 'ãµã­', emoji: 'ğŸš¢', text: 'ãµã­ãŒ ã¼ãƒ¼ã£', speak: 'ãµã­ãŒã€ã¼ãƒ¼ã£' },
            { char: 'ã‚', word: 'ã‚ã‘ã£ã¨', emoji: 'ğŸš€', text: 'ã‚ã‘ã£ã¨ ã¯ã£ã—ã‚ƒ', speak: 'ã‚ã‘ã£ã¨ã€ã¯ã£ã—ã‚ƒ' },
            { char: 'ã˜', word: 'ã˜ã¦ã‚“ã—ã‚ƒ', emoji: 'ğŸš²', text: 'ã˜ã¦ã‚“ã—ã‚ƒ ãƒãƒªãƒ³ãƒãƒªãƒ³', speak: 'ã˜ã¦ã‚“ã—ã‚ƒã€ã¡ã‚Šã‚“ã¡ã‚Šã‚“' }
        ];

        let currentTarget = null;
        let gameDeck = []; 
        let remainingCards = [];
        const synth = window.speechSynthesis;
        let voices = [];

        // --- Utils ---
        function setStatus(msg) {
            document.getElementById('statusLine').textContent = msg;
        }

        // --- Audio Context (SE) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function playSound(type) {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                const now = audioCtx.currentTime;

                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(880, now);
                    osc.frequency.setValueAtTime(1760, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start();
                    osc.stop(now + 0.5);
                } else {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, now);
                    osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.3);
                    osc.start();
                    osc.stop(now + 0.3);
                }
                osc.connect(gain);
                gain.connect(audioCtx.destination);
            } catch(e) {}
        }

        // --- Speech Logic ---
        window.speechSynthesis.onvoiceschanged = function() {
            voices = window.speechSynthesis.getVoices();
        };

        function resetSpeech() {
            if (synth) {
                synth.cancel();
                setStatus('éŸ³å£°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            }
        }

        function speak(text) {
            if (!synth) {
                setStatus('ã‚¨ãƒ©ãƒ¼: èª­ã¿ä¸Šã’éå¯¾å¿œã®ç«¯æœ«ã§ã™');
                return;
            }
            synth.cancel();

            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = 'ja-JP'; 
            uttr.rate = 0.9;
            uttr.volume = 1.0;

            if (voices.length > 0) {
                const jpVoice = voices.find(v => v.lang.includes('ja'));
                if (jpVoice) uttr.voice = jpVoice;
            }

            uttr.onstart = () => setStatus('å†ç”Ÿä¸­: ' + text);
            uttr.onend = () => setStatus('å†ç”Ÿå®Œäº†');
            uttr.onerror = (e) => setStatus('å†ç”Ÿã‚¨ãƒ©ãƒ¼');

            synth.speak(uttr);
        }

        function speakCurrent() {
            if (currentTarget) speak(currentTarget.speak);
        }

        // --- Game Logic ---
        function initGame() {
            const grid = document.getElementById('cardGrid');
            grid.innerHTML = '';
            
            // ãƒ©ãƒ³ãƒ€ãƒ é¸å‡º
            const shuffledMaster = [...masterData].sort(() => Math.random() - 0.5);
            gameDeck = shuffledMaster.slice(0, 12);
            remainingCards = [...gameDeck];

            // ç”»é¢é…ç½®ç”¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            const displayCards = [...gameDeck].sort(() => Math.random() - 0.5);

            displayCards.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${item.char}-${item.word}`;
                card.innerHTML = `
                    <div class="card-char">${item.char}</div>
                    <div class="card-img">${item.emoji}</div>
                    <div class="card-word">${item.word}</div>
                `;
                card.onclick = () => checkAnswer(item);
                grid.appendChild(card);
            });
        }

        function nextTurn() {
            document.getElementById('nextOverlay').style.display = 'none';

            if (remainingCards.length === 0) {
                document.getElementById('displayText').textContent = 'ãŠã‚ã‚Šï¼';
                speak('ãŠã—ã¾ã„ã§ã™ã€‚ã¾ãŸã‚ãã‚“ã§ã­ï¼');
                setTimeout(() => {
                   if(confirm('ã‚‚ã†ã„ã¡ã©ã€ã¡ãŒã†ã‚«ãƒ¼ãƒ‰ã§ã‚ãã¶ï¼Ÿ')) {
                       location.reload();
                   }
                }, 3000);
                return;
            }

            const idx = Math.floor(Math.random() * remainingCards.length);
            currentTarget = remainingCards[idx];
            
            document.getElementById('displayText').textContent = currentTarget.text;
            speak(currentTarget.speak);
        }

        function checkAnswer(item) {
            if (!currentTarget) return;

            if (item.word === currentTarget.word) {
                // Correct
                playSound('correct');
                const card = document.getElementById(`card-${item.char}-${item.word}`);
                card.classList.add('correct');
                setTimeout(() => {
                    card.classList.add('taken');
                }, 500);
                
                remainingCards = remainingCards.filter(c => c.word !== currentTarget.word);
                currentTarget = null;

                // Show Next Button
                setTimeout(() => {
                    document.getElementById('nextOverlay').style.display = 'flex';
                    setStatus('æ­£è§£ï¼ã¤ãã¸ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­');
                }, 500);
            } else {
                // Wrong
                playSound('wrong');
                setStatus('ã¯ãšã‚Œï¼');
            }
        }

        // --- Event Listeners ---
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!audioCtx) audioCtx = new AudioContext();
            audioCtx.resume();

            if (synth) {
                synth.cancel();
                voices = synth.getVoices();
                const dummy = new SpeechSynthesisUtterance('');
                synth.speak(dummy);
            }

            document.getElementById('startScreen').style.display = 'none';
            initGame();
            
            setTimeout(() => {
                nextTurn();
            }, 500);
        });

        document.getElementById('nextBtn').addEventListener('click', nextTurn);

        window.speechSynthesis.getVoices();

    </script>
</body>
</html>
