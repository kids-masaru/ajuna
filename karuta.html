<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Çè„Åè„Çè„Åè „Åã„Çã„Åü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700&display=swap');

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            touch-action: none;
            background-color: #fff7ed;
            user-select: none;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        /* Start Screen */
        #startScreen {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.98);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        /* Header / Controls */
        .header-area {
            width: 100%;
            padding: 5px 15px;
            background: #ffedd5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #fb923c;
            height: 45px;
            flex-shrink: 0;
        }
        .reset-btn {
            background: #cbd5e1;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            cursor: pointer;
            border: 2px solid #94a3b8;
        }

        /* Reader Area */
        .reader-area {
            width: 100%;
            padding: 8px;
            background: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 85px;
            border-bottom: 4px solid #fb923c;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            z-index: 20;
            flex-shrink: 0;
        }
        .reader-text {
            font-size: 1.4rem;
            color: #ea580c;
            margin-bottom: 6px;
            font-weight: bold;
            white-space: nowrap;
        }
        .replay-btn {
            background: #fbbf24;
            color: #78350f;
            padding: 5px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 3px 0 #d97706;
            font-weight: bold;
        }
        .replay-btn:active { transform: translateY(3px); box-shadow: none; }

        /* Grid */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            width: 100%;
            max-width: 500px;
            padding: 10px;
            flex-grow: 1;
            overflow-y: auto;
            align-content: center;
        }

        /* Card */
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 2px solid #fed7aa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            aspect-ratio: 5/6;
        }
        .card:active { background: #ffedd5; transform: scale(0.95); }
        .card.correct { border-color: #22c55e; background: #dcfce7; transform: scale(1.05); z-index: 10; }
        .card.taken { opacity: 0; pointer-events: none; }
        
        .card-char { font-size: 1.3rem; color: #ea580c; position: absolute; top: 2px; right: 4px; font-weight: bold; }
        .card-img { font-size: 2.6rem; }
        .card-word { font-size: 0.65rem; color: #9ca3af; margin-top: 1px; }

        /* Next Button Overlay */
        #nextOverlay {
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.9);
            z-index: 40;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .next-btn {
            background: #22c55e;
            color: white;
            font-size: 2.2rem;
            padding: 20px 80px;
            border-radius: 999px;
            box-shadow: 0 8px 0 #15803d;
            font-weight: bold;
            animation: bounce 1s infinite;
        }
        .next-btn:active { transform: translateY(4px); box-shadow: none; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        /* Status Line */
        #statusLine {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #333;
            color: #4ade80;
            font-size: 10px;
            padding: 2px;
            text-align: center;
            z-index: 100;
        }
    </style>
</head>
<body>

    <a href="index.html" style="position:fixed; top:5px; left:5px; z-index:100; background:white; width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; text-decoration:none; border:2px solid #fb923c; font-size:1.2rem; box-shadow:0 2px 5px rgba(0,0,0,0.2);">üè†</a>

    <div id="startScreen">
        <div class="text-7xl mb-6">üöìüê∂üçé</div>
        <h1 class="text-4xl text-orange-600 font-bold mb-4">„Çè„Åè„Çè„Åè „Åã„Çã„Åü</h1>
        <p class="text-gray-500 mb-8 text-sm leading-relaxed">
            „Å©„ÅÜ„Å∂„Å§„ÄÅ„ÅÆ„Çä„ÇÇ„ÅÆ„ÄÅ<br>
            „ÇÑ„Åï„ÅÑ„ÄÅ„Åè„Å†„ÇÇ„ÅÆ „Åå<br>
            „É©„É≥„ÉÄ„É†„Åß „Åß„Å¶„Åè„Çã„ÇàÔºÅ
        </p>
        <button id="startBtn" class="bg-orange-500 text-white text-3xl font-bold py-5 px-16 rounded-full shadow-[0_6px_0_#c2410c] active:translate-y-1 transition-all">
            „ÅØ„Åò„ÇÅ„ÇãÔºÅ
        </button>
    </div>

    <div class="header-area">
        <div style="width: 36px;"></div> <div class="font-bold text-orange-800">„Åã„Çã„Åü</div>
        <button onclick="resetSpeech()" class="reset-btn" title="Èü≥Â£∞„Çí„Å™„Åä„Åô">üîÑ</button>
    </div>

    <div class="reader-area">
        <div id="displayText" class="reader-text">...</div>
        <button onclick="speakCurrent()" class="replay-btn">üîä „ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑ</button>
    </div>

    <div id="cardGrid" class="card-grid"></div>

    <div id="nextOverlay">
        <div class="text-5xl mb-6 text-green-500 font-bold">„Åõ„ÅÑ„Åã„ÅÑÔºÅ‚≠ï</div>
        <button id="nextBtn" class="next-btn">„Å§„Åé„Å∏ ‚ñ∂</button>
    </div>

    <div id="statusLine">Ê∫ñÂÇôÂÆå‰∫Ü</div>

    <script>
        // --- Master Data (Pool) ---
        const masterData = [
            // --- „Å©„ÅÜ„Å∂„Å§ ---
            { char: '„ÅÑ', word: '„ÅÑ„Å¨', emoji: 'üê∂', text: '„ÅÑ„Å¨„Åå „Çè„Çì„Çè„Çì', speak: '„ÅÑ„Å¨„Åå„ÄÅ„Çè„Çì„Çè„Çì' },
            { char: '„Å≠', word: '„Å≠„Åì', emoji: 'üê±', text: '„Å≠„Åì„Åå „Å´„ÇÉ„Éº„Å´„ÇÉ„Éº', speak: '„Å≠„Åì„Åå„ÄÅ„Å´„ÇÉ„Éº„Å´„ÇÉ„Éº' },
            { char: '„ÅÜ', word: '„ÅÜ„Åï„Åé', emoji: 'üê∞', text: '„ÅÜ„Åï„Åé„Åå „Å¥„Çá„Çì„Å¥„Çá„Çì', speak: '„ÅÜ„Åï„Åé„Åå„ÄÅ„Å¥„Çá„Çì„Å¥„Çá„Çì' },
            { char: '„Å±', word: '„Å±„Çì„Å†', emoji: 'üêº', text: '„Å±„Çì„Å†„Åå „ÇÇ„Åê„ÇÇ„Åê', speak: '„Å±„Çì„Å†„Åå„ÄÅ„ÇÇ„Åê„ÇÇ„Åê' },
            { char: '„Çâ', word: '„Çâ„ÅÑ„Åä„Çì', emoji: 'ü¶Å', text: '„Çâ„ÅÑ„Åä„Çì „Åå„Åä„Éº', speak: '„Çâ„ÅÑ„Åä„Çì„ÄÅ„Åå„Åä„Éº' },
            { char: '„Åû', word: '„Åû„ÅÜ', emoji: 'üêò', text: '„Åû„ÅÜ„Åï„Çì „Å±„Åä„Éº„Çì', speak: '„Åû„ÅÜ„Åï„Çì„ÄÅ„Å±„Åä„Éº„Çì' },
            { char: '„Åï', word: '„Åï„Çã', emoji: 'üêµ', text: '„Åï„Çã„Åå „ÅÜ„Åç„Åç', speak: '„Åï„Çã„Åå„ÄÅ„ÅÜ„Åç„Åç' },
            { char: '„Åè', word: '„Åè„Åæ', emoji: 'üêª', text: '„Åè„Åæ„Åï„Çì „ÅÆ„Å£„Åó„ÅÆ„Å£„Åó', speak: '„Åè„Åæ„Åï„Çì„ÄÅ„ÅÆ„Å£„Åó„ÅÆ„Å£„Åó' },
            { char: '„Åç', word: '„Åç„Çä„Çì', emoji: 'ü¶í', text: '„Åç„Çä„Çì„Åï„Çì È¶ñ„Å™„Åå„ÅÑ', speak: '„Åç„Çä„Çì„Åï„Çì„ÄÅ„Åè„Å≥„Å™„Åå„ÅÑ' },
            { char: '„Å∫', word: '„Å∫„Çì„Åé„Çì', emoji: 'üêß', text: '„Å∫„Çì„Åé„Çì „Çà„Å°„Çà„Å°', speak: '„Å∫„Çì„Åé„Çì„ÄÅ„Çà„Å°„Çà„Å°' },
            { char: '„Åã', word: '„Åã„Åà„Çã', emoji: 'üê∏', text: '„Åã„Åà„Çã„Åå „Åë„Çç„Åë„Çç', speak: '„Åã„Åà„Çã„Åå„ÄÅ„Åë„Çç„Åë„Çç' },
            { char: '„Åì', word: '„Åì„ÅÇ„Çâ', emoji: 'üê®', text: '„Åì„ÅÇ„Çâ„Åå „Åô„ÇÑ„Åô„ÇÑ', speak: '„Åì„ÅÇ„Çâ„Åå„ÄÅ„Åô„ÇÑ„Åô„ÇÑ' },
            { char: '„Å®', word: '„Å®„Çâ', emoji: 'üêØ', text: '„Å®„Çâ„Åï„Çì „Å§„Çà„ÅÑ„Åû', speak: '„Å®„Çâ„Åï„Çì„ÄÅ„Å§„Çà„ÅÑ„Åû' },
            { char: '„ÅÜ', word: '„ÅÜ„Åæ', emoji: 'üê¥', text: '„ÅÜ„Åæ„Åå „Å≤„Å≤„Éº„Çì', speak: '„ÅÜ„Åæ„Åå„ÄÅ„Å≤„Å≤„Éº„Çì' },
            { char: '„ÅÜ', word: '„ÅÜ„Åó', emoji: 'üêÆ', text: '„ÅÜ„Åó„Åï„Çì „ÇÇ„Éº„ÇÇ„Éº', speak: '„ÅÜ„Åó„Åï„Çì„ÄÅ„ÇÇ„Éº„ÇÇ„Éº' },
            { char: '„Å´', word: '„Å´„Çè„Å®„Çä', emoji: 'üêî', text: '„Å´„Çè„Å®„Çä „Ç≥„Ç±„Ç≥„ÉÉ„Ç≥„Éº', speak: '„Å´„Çè„Å®„Çä„ÄÅ„Åì„Åë„Åì„Å£„Åì„Éº' },
            
            // --- „ÅÆ„Çä„ÇÇ„ÅÆ ---
            { char: '„Å±', word: '„Å±„Å®„Åã„Éº', emoji: 'üöì', text: '„Å±„Å®„Åã„Éº „Å¥„Éº„ÅΩ„Éº', speak: '„Å±„Å®„Åã„Éº„ÄÅ„Å¥„Éº„ÅΩ„Éº' },
            { char: '„Åç', word: '„Åç„ÇÖ„ÅÜ„Åç„ÇÖ„ÅÜ„Åó„ÇÉ', emoji: 'üöë', text: '„Åç„ÇÖ„ÅÜ„Åç„ÇÖ„ÅÜ„Åó„ÇÉ „Éî„Éº„Éù„Éº', speak: '„Åç„ÇÖ„ÅÜ„Åç„ÇÖ„ÅÜ„Åó„ÇÉ„ÄÅ„Å¥„Éº„ÅΩ„Éº' },
            { char: '„Åó', word: '„Åó„Çá„ÅÜ„Åº„ÅÜ„Åó„ÇÉ', emoji: 'üöí', text: '„Åó„Çá„ÅÜ„Åº„ÅÜ„Åó„ÇÉ „Ç¶„Éº„Ç´„É≥„Ç´„É≥', speak: '„Åó„Çá„ÅÜ„Åº„ÅÜ„Åó„ÇÉ„ÄÅ„ÅÜ„Éº„Åã„Çì„Åã„Çì' },
            { char: '„Åß', word: '„Åß„Çì„Åó„ÇÉ', emoji: 'üöÉ', text: '„Åß„Çì„Åó„ÇÉ „Ç¨„Çø„É≥„Ç¥„Éà„É≥', speak: '„Åß„Çì„Åó„ÇÉ„ÄÅ„Åå„Åü„Çì„Åî„Å®„Çì' },
            { char: '„Åó', word: '„Åó„Çì„Åã„Çì„Åõ„Çì', emoji: 'üöÖ', text: '„Åó„Çì„Åã„Çì„Åõ„Çì „Éì„É•„Éº„É≥', speak: '„Åó„Çì„Åã„Çì„Åõ„Çì„ÄÅ„Å≥„ÇÖ„Éº„Çì' },
            { char: '„Å∞', word: '„Å∞„Åô', emoji: 'üöå', text: '„Å∞„Åô „Éó„ÉÉ„Éó„Éº', speak: '„Å∞„Åô„ÄÅ„Å∑„Å£„Å∑„Éº' },
            { char: '„Åü', word: '„Åü„Åè„Åó„Éº', emoji: 'üöï', text: '„Åü„Åè„Åó„Éº „Åä„Åç„ÇÉ„Åè„Åï„Çì', speak: '„Åü„Åè„Åó„Éº„ÄÅ„Åä„Åç„ÇÉ„Åè„Åï„Çì' },
            { char: '„Å®', word: '„Å®„Çâ„Å£„Åè', emoji: 'üöö', text: '„Å®„Çâ„Å£„Åè „Éñ„Éº„É≥', speak: '„Å®„Çâ„Å£„Åè„ÄÅ„Å∂„Éº„Çì' },
            { char: '„Å≤', word: '„Å≤„Åì„ÅÜ„Åç', emoji: '‚úàÔ∏è', text: '„Å≤„Åì„ÅÜ„Åç „Ç≠„Éº„É≥', speak: '„Å≤„Åì„ÅÜ„Åç„ÄÅ„Åç„Éº„Çì' },
            { char: '„Åµ', word: '„Åµ„Å≠', emoji: 'üö¢', text: '„Åµ„Å≠„Åå „Åº„Éº„Å£', speak: '„Åµ„Å≠„Åå„ÄÅ„Åº„Éº„Å£' },
            { char: '„Çç', word: '„Çç„Åë„Å£„Å®', emoji: 'üöÄ', text: '„Çç„Åë„Å£„Å® „ÅØ„Å£„Åó„ÇÉ', speak: '„Çç„Åë„Å£„Å®„ÄÅ„ÅØ„Å£„Åó„ÇÉ' },
            { char: '„Åò', word: '„Åò„Å¶„Çì„Åó„ÇÉ', emoji: 'üö≤', text: '„Åò„Å¶„Çì„Åó„ÇÉ „ÉÅ„É™„É≥„ÉÅ„É™„É≥', speak: '„Åò„Å¶„Çì„Åó„ÇÉ„ÄÅ„Å°„Çä„Çì„Å°„Çä„Çì' },

            // --- „ÇÑ„Åï„ÅÑ ---
            { char: '„Å®', word: '„Å®„Åæ„Å®', emoji: 'üçÖ', text: '„Å®„Åæ„Å® „Åæ„Å£„Åã„Å£„Åã', speak: '„Å®„Åæ„Å®„ÄÅ„Åæ„Å£„Åã„Å£„Åã' },
            { char: '„Å´', word: '„Å´„Çì„Åò„Çì', emoji: 'ü•ï', text: '„Å´„Çì„Åò„Çì „ÅΩ„Çä„ÅΩ„Çä', speak: '„Å´„Çì„Åò„Çì„ÄÅ„ÅΩ„Çä„ÅΩ„Çä' },
            { char: '„Å™', word: '„Å™„Åô', emoji: 'üçÜ', text: '„Å™„Åô„Å≥ „Å§„ÇÑ„Å§„ÇÑ', speak: '„Å™„Åô„Å≥„ÄÅ„Å§„ÇÑ„Å§„ÇÑ' },
            { char: '„Åç', word: '„Åç„ÇÖ„ÅÜ„Çä', emoji: 'ü•í', text: '„Åç„ÇÖ„ÅÜ„Çä „ÅΩ„Çä„ÅΩ„Çä', speak: '„Åç„ÇÖ„ÅÜ„Çä„ÄÅ„ÅΩ„Çä„ÅΩ„Çä' },
            { char: '„Å®', word: '„Å®„ÅÜ„ÇÇ„Çç„Åì„Åó', emoji: 'üåΩ', text: '„Å®„ÅÜ„ÇÇ„Çç„Åì„Åó „Å§„Å∂„Å§„Å∂', speak: '„Å®„ÅÜ„ÇÇ„Çç„Åì„Åó„ÄÅ„Å§„Å∂„Å§„Å∂' },
            { char: '„Åã', word: '„Åã„Åº„Å°„ÇÉ', emoji: 'üéÉ', text: '„Åã„Åº„Å°„ÇÉ „Åî„Çç„Åî„Çç', speak: '„Åã„Åº„Å°„ÇÉ„ÄÅ„Åî„Çç„Åî„Çç' },
            { char: '„Åï', word: '„Åï„Å§„Åæ„ÅÑ„ÇÇ', emoji: 'üç†', text: '„Åï„Å§„Åæ„ÅÑ„ÇÇ „Åª„Åè„Åª„Åè', speak: '„Åï„Å§„Åæ„ÅÑ„ÇÇ„ÄÅ„Åª„Åè„Åª„Åè' },
            { char: '„Å¥', word: '„Å¥„Éº„Åæ„Çì', emoji: 'ü´ë', text: '„Å¥„Éº„Åæ„Çì „Åø„Å©„Çä„ÅÑ„Çç', speak: '„Å¥„Éº„Åæ„Çì„ÄÅ„Åø„Å©„Çä„ÅÑ„Çç' },
            { char: '„Å∂', word: '„Å∂„Çç„Å£„Åì„Çä„Éº', emoji: 'ü•¶', text: '„Å∂„Çç„Å£„Åì„Çä„Éº „ÇÇ„Åì„ÇÇ„Åì', speak: '„Å∂„Çç„Å£„Åì„Çä„Éº„ÄÅ„ÇÇ„Åì„ÇÇ„Åì' },
            { char: '„Åü', word: '„Åü„Åæ„Å≠„Åé', emoji: 'üßÖ', text: '„Åü„Åæ„Å≠„Åé „Åæ„Çã„ÅÑ„Å≠', speak: '„Åü„Åæ„Å≠„Åé„ÄÅ„Åæ„Çã„ÅÑ„Å≠' },
            { char: '„Åò', word: '„Åò„ÇÉ„Åå„ÅÑ„ÇÇ', emoji: 'ü•î', text: '„Åò„ÇÉ„Åå„ÅÑ„ÇÇ „Åî„Çç„Åî„Çç', speak: '„Åò„ÇÉ„Åå„ÅÑ„ÇÇ„ÄÅ„Åî„Çç„Åî„Çç' },

            // --- „Åè„Å†„ÇÇ„ÅÆÔºàNEW!Ôºâ ---
            { char: '„Çä', word: '„Çä„Çì„Åî', emoji: 'üçé', text: '„Çä„Çì„Åî„Åå „Åæ„Å£„Åã„Å£„Åã', speak: '„Çä„Çì„Åî„Åå„ÄÅ„Åæ„Å£„Åã„Å£„Åã' },
            { char: '„Å∞', word: '„Å∞„Å™„Å™', emoji: 'üçå', text: '„Å∞„Å™„Å™„Åå „Åç„ÅÑ„Çç„Å†„Çà', speak: '„Å∞„Å™„Å™„Åå„ÄÅ„Åç„ÅÑ„Çç„Å†„Çà' },
            { char: '„Å∂', word: '„Å∂„Å©„ÅÜ', emoji: 'üçá', text: '„Å∂„Å©„ÅÜ„Åå „Å§„Å∂„Å§„Å∂', speak: '„Å∂„Å©„ÅÜ„Åå„ÄÅ„Å§„Å∂„Å§„Å∂' },
            { char: '„ÅÑ', word: '„ÅÑ„Å°„Åî', emoji: 'üçì', text: '„ÅÑ„Å°„Åî„Åå „ÅÇ„Åæ„ÅÑ„Å≠', speak: '„ÅÑ„Å°„Åî„Åå„ÄÅ„ÅÇ„Åæ„ÅÑ„Å≠' },
            { char: '„ÇÇ', word: '„ÇÇ„ÇÇ', emoji: 'üçë', text: '„ÇÇ„ÇÇ„Åï„Çì „Å¥„Çì„Åè„ÅÑ„Çç', speak: '„ÇÇ„ÇÇ„Åï„Çì„ÄÅ„Å¥„Çì„Åè„ÅÑ„Çç' },
            { char: '„ÇÅ', word: '„ÇÅ„Çç„Çì', emoji: 'üçà', text: '„ÇÅ„Çç„Çì„Åå „ÅÇ„Åø„ÅÇ„Åø', speak: '„ÇÅ„Çç„Çì„Åå„ÄÅ„ÅÇ„Åø„ÅÇ„Åø' },
            { char: '„Åô', word: '„Åô„ÅÑ„Åã', emoji: 'üçâ', text: '„Åô„ÅÑ„Åã„Åå „Åó„Åæ„Åó„Åæ', speak: '„Åô„ÅÑ„Åã„Åå„ÄÅ„Åó„Åæ„Åó„Åæ' },
            { char: '„Åø', word: '„Åø„Åã„Çì', emoji: 'üçä', text: '„Åø„Åã„Çì„Åå „Ç™„É¨„É≥„Ç∏', speak: '„Åø„Åã„Çì„Åå„ÄÅ„Åä„Çå„Çì„Åò' },
            { char: '„Å±', word: '„Å±„ÅÑ„Å™„Å£„Å∑„Çã', emoji: 'üçç', text: '„Å±„ÅÑ„Å™„Å£„Å∑„Çã „Éà„Ç≤„Éà„Ç≤', speak: '„Å±„ÅÑ„Å™„Å£„Å∑„Çã„ÄÅ„Å®„Åí„Å®„Åí' },
            { char: '„Åï', word: '„Åï„Åè„Çâ„Çì„Åº', emoji: 'üçí', text: '„Åï„Åè„Çâ„Çì„Åº „Å™„Åã„Çà„Åó', speak: '„Åï„Åè„Çâ„Çì„Åº„ÄÅ„Å™„Åã„Çà„Åó' },
            { char: '„Çå', word: '„Çå„ÇÇ„Çì', emoji: 'üçã', text: '„Çå„ÇÇ„Çì„Åå „Åô„Å£„Å±„ÅÑ', speak: '„Çå„ÇÇ„Çì„Åå„ÄÅ„Åô„Å£„Å±„ÅÑ' }
        ];

        let currentTarget = null;
        let gameDeck = []; 
        let remainingCards = [];
        const synth = window.speechSynthesis;
        let voices = [];

        // --- Utils ---
        function setStatus(msg) {
            document.getElementById('statusLine').textContent = msg;
        }

        // --- Audio Context (SE) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function playSound(type) {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                const now = audioCtx.currentTime;

                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(880, now);
                    osc.frequency.setValueAtTime(1760, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start();
                    osc.stop(now + 0.5);
                } else {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, now);
                    osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.3);
                    osc.start();
                    osc.stop(now + 0.3);
                }
                osc.connect(gain);
                gain.connect(audioCtx.destination);
            } catch(e) {}
        }

        // --- Speech Logic ---
        window.speechSynthesis.onvoiceschanged = function() {
            voices = window.speechSynthesis.getVoices();
        };

        function resetSpeech() {
            if (synth) {
                synth.cancel();
                setStatus('Èü≥Â£∞„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
            }
        }

        function speak(text) {
            if (!synth) {
                setStatus('„Ç®„É©„Éº: Ë™≠„Åø‰∏ä„ÅíÈùûÂØæÂøú„ÅÆÁ´ØÊú´„Åß„Åô');
                return;
            }
            synth.cancel();

            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = 'ja-JP'; 
            uttr.rate = 0.9;
            uttr.volume = 1.0;

            if (voices.length > 0) {
                const jpVoice = voices.find(v => v.lang.includes('ja'));
                if (jpVoice) uttr.voice = jpVoice;
            }

            uttr.onstart = () => setStatus('ÂÜçÁîü‰∏≠: ' + text);
            uttr.onend = () => setStatus('ÂÜçÁîüÂÆå‰∫Ü');
            uttr.onerror = (e) => setStatus('ÂÜçÁîü„Ç®„É©„Éº');

            synth.speak(uttr);
        }

        function speakCurrent() {
            if (currentTarget) speak(currentTarget.speak);
        }

        // --- Game Logic ---
        function initGame() {
            const grid = document.getElementById('cardGrid');
            grid.innerHTML = '';
            
            // „É©„É≥„ÉÄ„É†ÈÅ∏Âá∫
            const shuffledMaster = [...masterData].sort(() => Math.random() - 0.5);
            gameDeck = shuffledMaster.slice(0, 12);
            remainingCards = [...gameDeck];

            // ÁîªÈù¢ÈÖçÁΩÆÁî®„Ç∑„É£„ÉÉ„Éï„É´
            const displayCards = [...gameDeck].sort(() => Math.random() - 0.5);

            displayCards.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${item.char}-${item.word}`;
                card.innerHTML = `
                    <div class="card-char">${item.char}</div>
                    <div class="card-img">${item.emoji}</div>
                    <div class="card-word">${item.word}</div>
                `;
                card.onclick = () => checkAnswer(item);
                grid.appendChild(card);
            });
        }

        function nextTurn() {
            document.getElementById('nextOverlay').style.display = 'none';

            if (remainingCards.length === 0) {
                document.getElementById('displayText').textContent = '„Åä„Çè„ÇäÔºÅ';
                speak('„Åä„Åó„Åæ„ÅÑ„Åß„Åô„ÄÇ„Åæ„Åü„ÅÇ„Åù„Çì„Åß„Å≠ÔºÅ');
                setTimeout(() => {
                   if(confirm('„ÇÇ„ÅÜ„ÅÑ„Å°„Å©„ÄÅ„Å°„Åå„ÅÜ„Ç´„Éº„Éâ„Åß„ÅÇ„Åù„Å∂Ôºü')) {
                       location.reload();
                   }
                }, 3000);
                return;
            }

            const idx = Math.floor(Math.random() * remainingCards.length);
            currentTarget = remainingCards[idx];
            
            document.getElementById('displayText').textContent = currentTarget.text;
            speak(currentTarget.speak);
        }

        function checkAnswer(item) {
            if (!currentTarget) return;

            if (item.word === currentTarget.word) {
                // Correct
                playSound('correct');
                const card = document.getElementById(`card-${item.char}-${item.word}`);
                card.classList.add('correct');
                setTimeout(() => {
                    card.classList.add('taken');
                }, 500);
                
                remainingCards = remainingCards.filter(c => c.word !== currentTarget.word);
                currentTarget = null;

                // Show Next Button
                setTimeout(() => {
                    document.getElementById('nextOverlay').style.display = 'flex';
                    setStatus('Ê≠£Ëß£ÔºÅ„Å§„Åé„Å∏„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Å≠');
                }, 500);
            } else {
                // Wrong
                playSound('wrong');
                setStatus('„ÅØ„Åö„ÇåÔºÅ');
            }
        }

        // --- Event Listeners ---
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!audioCtx) audioCtx = new AudioContext();
            audioCtx.resume();

            if (synth) {
                synth.cancel();
                voices = synth.getVoices();
                const dummy = new SpeechSynthesisUtterance('');
                synth.speak(dummy);
            }

            document.getElementById('startScreen').style.display = 'none';
            initGame();
            
            setTimeout(() => {
                nextTurn();
            }, 500);
        });

        document.getElementById('nextBtn').addEventListener('click', nextTurn);

        window.speechSynthesis.getVoices();

    </script>
</body>
</html>
